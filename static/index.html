<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ecom Scraper</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- First Section - Logos and Heading -->
    <section class="container mt-4">
      <div class="row">
        <!-- First Section - Logo -->
        <div class="col-md-3 text-center mb-4 mb-md-0">
          <!-- Add your logo or content here -->
          <img
            src="webscrping.webp"
            alt="/in/muhammad-zaeem-khan"
            class="img-fluid"
            style="max-width: 8rem"
          />
        </div>

        <!-- Mid Section - Heading -->
        <div class="col-md-6 text-center">
          <h1>E-commerce Product Scraping Tool</h1>
        </div>

        <!-- Last Section - Logo -->
        <div class="col-md-3 text-center">
          <!-- Add another logo or content here -->
          <img
            src="webscrping.webp"
            alt="/in/muhammad-zaeem-khan"
            class="img-fluid"
            style="max-width: 8rem"
          />
        </div>
      </div>
    </section>

    <!-- Second and Third Sections - Centered Form and Product Card (Initially Hidden) -->
    <div class="container mt-4">
      <div class="row justify-content-center">
        <!-- Second Section - Centered Form -->
        <div class="col-md-6">
          <!-- Form -->
          <form id="search-form" class="needs-validation">
            <!-- First Section - Select for Name -->
            <div class="mb-3">
              <label for="web-name">Select the search source:</label>
              <select
                class="form-select"
                id="web-name"
                name="web-name"
                required
              >
                <option value="" disabled selected>Select a website</option>
                <option value="www2.cip1.com">www2.cip1.com</option>
                <option value="www.ebay.com">www.ebay.com</option>
                <option value="www.partzilla.com">www.partzilla.com</option>
                <option value="partsouq.com">partsouq.com</option>
                <option value="amazon.com">amazon.com</option>
                <option value="www.aliexpress.com">www.aliexpress.com</option>
                <option value="url-search">Custom url search</option>
              </select>
              <div class="invalid-feedback">Please select a website.</div>
            </div>

            <!-- Second Section - Input for Search Text -->
            <div class="mb-3">
              <label for="search-text">Search through unique id / url:</label>
              <input
                type="text"
                class="form-control"
                id="search-text"
                name="search-text"
                placeholder="Enter Search Text"
                required
              />
              <div class="invalid-feedback">Please enter unique id / url.</div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary" id="search-button">
              Search
            </button>
            <!-- Loader -->
            <div
              class="spinner-border text-primary mt-2 d-none justify-content-center"
              id="loader"
              role="status"
            >
              <span class="visually-hidden">Loading...</span>
            </div>
          </form>
        </div>

        <!-- Third Section - Product Card (Initially Hidden) -->
        <div class="col-md-6 d-none" id="product-card-container">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <!-- Product Card -->
              <div class="card">
                <img
                  src="#"
                  alt="/in/muhammad-zaeem-khan"
                  class="card-img-top"
                  id="product-image"
                  style="
                    width: auto;
                    max-width: 15rem;
                    height: auto;
                    margin: auto;
                    max-height: 15rem;
                  "
                />
                <div class="card-body">
                  <h5 class="card-title" id="product-title"></h5>
                  <p class="card-text" id="product-description"></p>
                  <p class="card-text" id="product-price"></p>
                  <a
                    href="#"
                    class="btn btn-primary justify-content-center"
                    id="product-link"
                    target="_blank"
                    >View Product</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />

    <!-- Bootstrap JS (optional, only needed for certain components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Your custom script -->
    <script>
      $(document).ready(function () {
        // Add event listener to the form button
        $("#search-button").on("click", function (event) {
          event.preventDefault();

          // Validate the form
          var form = $("#search-form")[0];
          if (form.checkValidity() === false) {
            form.classList.add("was-validated");
            return;
          }

          // Show the loader and hide the button when the button is clicked
          $("#loader").removeClass("d-none");
          $("#search-button").addClass("d-none");

          // Get the selected option value from the web-name select element
          var selectedWebName = $("#web-name").val();

          // Get the input value from the search-text input element
          var searchText = $("#search-text").val();

          if (selectedWebName == "url-search") {
            $.ajax({
              url: "http://127.0.0.1:8000/get",
              type: "POST",
              data: {
                url: searchText,
              },
              headers: {
                "Access-Control-Allow-Origin": "*",
              },
              // withCredentials: true,
              crossDomain: true,
              success: function (data) {
                // Hide the loader and show the button when the response is received
                $("#loader").addClass("d-none");
                $("#search-button").removeClass("d-none");

                // Handle the successful response here
                console.log("Ajax call successful!", data);
                if (data.success === true) {
                  // Show the product card and update its content
                  $("#product-title").html(
                    data.prod_title?.replace(/\n/g, "<br/>")
                  );
                  $("#product-description").html(
                    data.prod_discription?.replace(/\n/g, "<br/>")
                  );
                  $("#product-price").html(
                    data.prod_price?.replace(/\n/g, "<br/>")
                  );
                  $("#product-link").attr("href", data.product_link);
                  $("#product-image").attr("src", data.img_link);
                  $("#product-card-container").removeClass("d-none");
                } else {
                  // Add a Bootstrap alert of error to show the error
                  var errorAlert =
                    '<div class="alert alert-danger mt-2" role="alert">Error: ' +
                    data.error +
                    "</div>";
                  $("#search-form").append(errorAlert);

                  setTimeout(() => {
                    $(".alert-danger").remove();
                  }, 5000);
                }
              },
              error: function (error) {
                // Hide the loader and show the button when the response is received
                $("#loader").addClass("d-none");
                $("#search-button").removeClass("d-none");

                // Handle the error response here
                console.error("Error in Ajax call!", error);
              },
            });
          } else {
            $.ajax({
              url: "http://127.0.0.1:8000/find",
              type: "POST",
              data: {
                id: searchText,
                webName: selectedWebName,
              },
              headers: {
                "Access-Control-Allow-Origin": "*",
              },
              // withCredentials: true,
              crossDomain: true,
              success: function (data) {
                // Hide the loader and show the button when the response is received
                $("#loader").addClass("d-none");
                $("#search-button").removeClass("d-none");

                // Handle the successful response here
                console.log("Ajax call successful!", data);
                if (data.success === true) {
                  // Show the product card and update its content
                  $("#product-title").html(
                    data.prod_title?.replace(/\n/g, "<br/>")
                  );
                  $("#product-description").html("");
                  $("#product-price").html(
                    data.prod_price?.replace(/\n/g, "<br/>")
                  );
                  $("#product-link").attr("href", data.product_link);
                  $("#product-image").attr("src", data.img_link);
                  $("#product-card-container").removeClass("d-none");
                } else {
                  // Add a Bootstrap alert of error to show the error
                  var errorAlert =
                    '<div class="alert alert-danger mt-2" role="alert">Error: ' +
                    data.error +
                    "</div>";
                  $("#search-form").append(errorAlert);

                  setTimeout(() => {
                    $(".alert-danger").remove();
                  }, 5000);
                }
              },
              error: function (error) {
                // Hide the loader and show the button when the response is received
                $("#loader").addClass("d-none");
                $("#search-button").removeClass("d-none");

                // Handle the error response here
                console.error("Error in Ajax call!", error);
              },
            });
          }

          // Make an Ajax call using the constructed URL
        });
      });
    </script>
  </body>
</html>
